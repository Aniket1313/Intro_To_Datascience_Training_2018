---
title: "capstone - statistics"
input: "bank_full_clean.csv"
---

```{R}
library(readr)
bank_full_clean <- read_csv("C:/Users/Alan/Desktop/bank_full_clean.csv")

# Explore the dataset with summary and str
str(bank_full_clean)
bank_numerical<-bank_full_clean[,c(2,7,11,13,14,15,16,17)]
bank_categorical<-bank_full_clean[,-c(1,2,7,11,13,14,15,16)]
summary(bank_numerical)

# Age histogram and removing outliers
library(ggplot2)
ggplot(bank_full_clean, aes(x=age)) + geom_histogram(binwidth = 5)
bank <- bank_full_clean[bank_full_clean$age <= 60 & bank_full_clean$age >= 25, ] 
plotseries<-function(yvar){
ggplot(bank, aes(x=age,fill = factor(yvar))) + geom_histogram(binwidth = 5)
}
lapply(bank[,c(3:6,8,9,17,18)], plotseries)

# Cleanup outliers
bank <- bank_full_clean[bank_full_clean$age <= 60 & bank_full_clean$age >= 25, ] 

##Crosstab - normal way
#create two dimensional tab
bank.tab<-table(bank$prev_outcome,bank$outcome_term_deposit)

#row marginal
margin.table(bank.tab,1)

#column marginal
margin.table(bank.tab,2) 

#cell %
round(prop.table(bank.tab),2)

#row %
round(prop.table(bank.tab,1),2) 

#column %
round(prop.table(bank.tab,2),2) 

#Chi-squared test
chisq.test(bank.tab)

#scatterplot through pairs function
pairs(bank_numerical)

##Chi-square p value matrix
chisqmatrix <- function(x) {
  names = colnames(x);  num = length(names)
  m = matrix(nrow=num,ncol=num,dimnames=list(names,names))
  for (i in 1:(num-1)) {
    for (j in (i+1):num) {
      m[i,j] = chisq.test(x[,i],x[,j],)$p.value
    }
  }
  return (m)
}
mat = chisqmatrix(bank_categorical)


## Error in chisq.test(x[, i], x[, j], ) : 
##  'x' and 'y' must have the same length 
```

```{R}
bank_numerical<-bank_full_clean[,c(2,7,11,13,14,15,16,19,20,21,22,18)]
bank_numerical$outcome_term_deposit<-as.numeric(as.factor(bank_numerical$outcome_term_deposit))
model1<-lm(outcome_term_deposit~age+annual_balance+last_contact_day+duration+contact_times+past_days+previous_contact_times+dummy_default_credit+dummy_housing_loan+dummy_personal_loan+dummy_outcome_term_deposit, data = bank_numerical)
summary(model1)
model2<-lm(outcome_term_deposit~age, data = bank_numerical)
summary(model2)


x<-bank_numerical[,1:2]
x$age<-log(x$age)
x$annual_balance<-log(x$annual_balance)
library(dplyr)
x<-filter(x,x$annual_balance != "NaN" )
x<-filter(x,x$annual_balance != "-Inf" )
x<-filter(x,x$age != "-Inf" )
x<-filter(x,x$age != "NaN" )
x<-na.omit(x)

clusters <- kmeans(x, 5)
library(cluster)
library(fpc)
plotcluster(x, clusters$cluster)

```
